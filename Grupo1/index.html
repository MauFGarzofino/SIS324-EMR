<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lista de Usuarios</title>
  <!-- Incluir Bootstrap CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div class="container mt-4">
    <h2>Lista de Usuarios y Administradores</h2>
    <div class="input-group mb-3">
      <input id="buscar" type="text" class="form-control" placeholder="Buscar usuarios...">
      <div class="input-group-append">
        <button class="btn btn-outline-secondary" type="button" onclick="buscar('buscar')">Buscar</button>
      </div>
    </div>

    <div id="tabla_usuarios">
      <!-- Contenido de la tabla -->
    </div>

    <div class="forms-container d-flex justify-content-between flex-wrap mt-5">
      <!-- Formulario EMR -->
      <div class="card" style="width: 48%;">
        <div class="card-body">
          <h5 class="card-title">Registro Médico Electrónico del Paciente</h5>
          <form id="formulario_emr">
            <!-- Campos del formulario -->
            <div class="form-group">
              <label for="historia_clinica">Historia Clínica:</label>
              <textarea id="historia_clinica" class="form-control" required></textarea>
            </div>
            <div class="form-group">
              <label for="diagnosticos">Diagnósticos:</label>
              <textarea id="diagnosticos" class="form-control" required></textarea>
            </div>
            <div class="form-group">
              <label for="tratamientos">Tratamientos Previos:</label>
              <textarea id="tratamientos" class="form-control" required></textarea>
            </div>
            <div class="form-group">
              <label for="pruebas_medicas">Pruebas Médicas:</label>
              <textarea id="pruebas_medicas" class="form-control" required></textarea>
            </div>
            <div class="form-group">
              <label for="alergias">Alergias:</label>
              <textarea id="alergias" class="form-control" required></textarea>
            </div>
            <button type="button" class="btn btn-primary" onclick="guardarEMR()">Guardar Registro</button>
          </form>
        </div>
      </div>

      <!-- Formulario de Usuario -->
      <div class="card" style="width: 48%;">
        <div class="card-body">
          <h5 class="card-title" id="formulario">Agregar Nuevo Usuario</h5>
          <form id="formulario_usuario">
            <div class="form-group">
              <label for="nombre">Nombre:</label>
              <input type="text" class="form-control" id="nombre" required>
            </div>
            <div class="form-group">
              <label for="apellido">Apellido:</label>
              <input type="text" class="form-control" id="apellido" required>
            </div>
            <div class="form-group">
              <label for="clave">Clave:</label>
              <input type="password" class="form-control" id="clave" required>
            </div>
            <div class="form-group">
              <label for="email">Email:</label>
              <input type="email" class="form-control" id="email" required>
            </div>
            <div class="form-group">
              <label for="rol">Rol:</label>
              <select id="rol" class="form-control" required>
                <option value="admin">Admin</option>
                <option value="user">User</option>
              </select>
            </div>
            <button id="boton1" type="button" class="btn btn-primary" onclick="agregarUsuario()">Agregar Usuario</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts necesarios para Bootstrap -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script src="usuario.js"></script>
  <!-- Tus scripts aquí -->
  <script src="usuario.js"></script>
  <script>
    console.log(controlUsuario.obtenerListaUsuarios());
    armar_tabla_usuarios(controlUsuario.obtenerListaUsuarios());
    function armar_tabla_usuarios(usuarios) {
      const tablaUsuarios = document.getElementById("tabla_usuarios");
      let html =
        `<table>` +
        `<thead> <tr>
<th>Id</th>
<th>Nombre</th>
<th>Apellido</th>
<th>Clave</th>
<th>Email</th>
<th>Rol</th>
<th>Operaciones</th>
</tr> </thead>
<tbody>`;
      usuarios.forEach(function (usuario) {
        html += `<tr>
<td>${usuario.id}</td>
<td>${usuario.nombre}</td>
<td>${usuario.apellido}</td>
<td>${usuario.clave}</td>
<td>${usuario.email}</td>
<td>${usuario.rol}</td>
<td>
<button id="editar" onclick="editar(${usuario.id})">Editar</button>
<button id="eliminar" onclick="eliminar(${usuario.id})">Eliminar</button>
</td>
</tr>`;
      });
      html += `</tbody> </table>`;
      tablaUsuarios.innerHTML = html;
    }
    function guardarEMR() {
      // Aquí iría la lógica para procesar y almacenar los datos del formulario EMR
      var historiaClinica = document.getElementById("historia_clinica").value;
      var diagnosticos = document.getElementById("diagnosticos").value;
      var tratamientos = document.getElementById("tratamientos").value;
      var pruebasMedicas = document.getElementById("pruebas_medicas").value;
      var alergias = document.getElementById("alergias").value;

      // Lógica para guardar esta información, por ejemplo, en una base de datos o local storage
      console.log(
        "Guardar EMR",
        historiaClinica,
        diagnosticos,
        tratamientos,
        pruebasMedicas,
        alergias
      );
    }
    function agregarUsuario() {
      const nombre = document.getElementById("nombre").value;
      const apellido = document.getElementById("apellido").value;
      const clave = document.getElementById("clave").value;
      const email = document.getElementById("email").value;
      const rol = document.getElementById("rol").value;
      const nuevoUsuario = new Usuario(
        controlUsuario.obtenerListaUsuarios().length,
        nombre,
        apellido,
        clave,
        email,
        rol
      );
      //agregamos
      controlUsuario.adicionar_Usuario(nuevoUsuario);
      // actualizamos
      armar_tabla_usuarios(controlUsuario.obtenerListaUsuarios());
      // Limpiamos el formulario
      document.getElementById("formulario_usuario").reset();
    }
    function editar(id) {
      const usuario = controlUsuario
        .obtenerListaUsuarios()
        .find((u) => u.id === id);
      document.getElementById("nombre").value = usuario.nombre;
      document.getElementById("apellido").value = usuario.apellido;
      document.getElementById("clave").value = usuario.clave;
      document.getElementById("email").value = usuario.email;
      document.getElementById("rol").value = usuario.rol;
      document.getElementById("formulario").innerHTML = "Editar Usuario";
      //const btn = document.querySelector("#formulario_usuario button");
      const btn = document.getElementById("boton1");
      btn.onclick = function () {
        guardarCambios(id);
      };
      btn.textContent = "Guardar Cambios";
    }
    function guardarCambios(id) {
      const usuario = controlUsuario
        .obtenerListaUsuarios()
        .find((u) => u.id === id);
      usuario.nombre = document.getElementById("nombre").value;
      usuario.apellido = document.getElementById("apellido").value;
      usuario.clave = document.getElementById("clave").value;
      usuario.email = document.getElementById("email").value;
      usuario.rol = document.getElementById("rol").value;
      armar_tabla_usuarios(controlUsuario.obtenerListaUsuarios());
      document.getElementById("formulario_usuario").reset();
      document.getElementById("formulario").innerHTML =
        "Agregar Nuevo Usuario";
      //const btn = document.querySelector("#formulario_usuario button");
      const btn = document.getElementById("boton1");
      btn.onclick = agregarUsuario;
      btn.textContent = "Agregar Usuario";
    }
    function eliminar(id) {
      const listaUsuarios = controlUsuario.obtenerListaUsuarios();
      const indiceUsuario = listaUsuarios.findIndex((u) => u.id === id);
      if (indiceUsuario !== -1) {
        listaUsuarios.splice(indiceUsuario, 1);
        armar_tabla_usuarios(listaUsuarios);
      }
    }
    function buscar(nom) {
      elemento = document.getElementById(nom).value;
      const usuariosEncontrados = controlUsuario
        .obtenerListaUsuarios(nom)
        .filter(
          (u) =>
            u.nombre.toLowerCase().includes(elemento.toLowerCase()) ||
            u.id === parseInt(elemento)
        );
      console.log(usuariosEncontrados);
      armar_tabla_usuarios(usuariosEncontrados);
    }
  </script>

</body>
</html>
