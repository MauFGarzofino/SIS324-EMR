<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lista de Usuarios</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <h2>Lista de Usuarios y Administradores</h2>
    <p>Nombre: Mauricio Joel Flores Garzofino</p>
    <p>Grupo de Laboratorio: 2</p>
    <label for="buscar">Realizar búsqueda</label>
    <input id="buscar" type="text" />
    <button id="buscar" onclick="buscar('buscar')">Buscar</button>
    <div class="container" id="tabla_usuarios">
      <!-- Contenido de la tabla -->
    </div>

    <div class="forms-container">
      <!-- Formulario EMR -->
      <div class="emr-form-container">
        <h2>Registro Médico Electrónico del Paciente</h2>
        <form class="emr-form" id="formulario_emr">
          <label for="historia_clinica">Historia Clínica:</label>
          <textarea id="historia_clinica" required></textarea>

          <label for="diagnosticos">Diagnósticos:</label>
          <textarea id="diagnosticos" required></textarea>

          <label for="tratamientos">Tratamientos Previos:</label>
          <textarea id="tratamientos" required></textarea>

          <label for="pruebas_medicas">Pruebas Médicas:</label>
          <textarea id="pruebas_medicas" required></textarea>

          <label for="alergias">Alergias:</label>
          <textarea id="alergias" required></textarea>

          <!-- Asumiendo que tendrás un script de JS para manejar la lógica del formulario EMR -->
          <button type="button" onclick="guardarEMR()">Guardar Registro</button>
        </form>
      </div>

      <h2 id="formulario">Agregar Nuevo Usuario</h2>
      <form id="formulario_usuario">
        <label for="nombre">Nombre:</label><br />
        <input type="text" id="nombre" required /><br />
        <label for="apellido">Apellido:</label><br />
        <input type="text" id="apellido" required /><br />
        <label for="clave">Clave:</label><br />
        <input type="password" id="clave" required /><br />
        <label for="email">Email:</label><br />
        <input type="email" id="email" required /><br />
        <label for="rol">Rol:</label><br />
        <select id="rol" required>
          <option value="admin">Admin</option>
          <option value="user">User</option></select
        ><br />
        <button id="boton1" type="button" onclick="agregarUsuario()">
          <a>Agregar Usuario</a>
        </button>
      </form>
    </div>
    <script src="usuario.js"></script>
    <script>
      console.log(controlUsuario.obtenerListaUsuarios());
      armar_tabla_usuarios(controlUsuario.obtenerListaUsuarios());
      function armar_tabla_usuarios(usuarios) {
        const tablaUsuarios = document.getElementById("tabla_usuarios");
        let html =
          `<table>` +
          `<thead> <tr>
<th>Id</th>
<th>Nombre</th>
<th>Apellido</th>
<th>Clave</th>
<th>Email</th>
<th>Rol</th>
<th>Operaciones</th>
</tr> </thead>
<tbody>`;
        usuarios.forEach(function (usuario) {
          html += `<tr>
<td>${usuario.id}</td>
<td>${usuario.nombre}</td>
<td>${usuario.apellido}</td>
<td>${usuario.clave}</td>
<td>${usuario.email}</td>
<td>${usuario.rol}</td>
<td>
<button id="editar" onclick="editar(${usuario.id})">Editar</button>
<button id="eliminar" onclick="eliminar(${usuario.id})">Eliminar</button>
</td>
</tr>`;
        });
        html += `</tbody> </table>`;
        tablaUsuarios.innerHTML = html;
      }
      // Script de ejemplo para manejar el formulario EMR
      function guardarEMR() {
        // Aquí iría la lógica para procesar y almacenar los datos del formulario EMR
        var historiaClinica = document.getElementById("historia_clinica").value;
        var diagnosticos = document.getElementById("diagnosticos").value;
        var tratamientos = document.getElementById("tratamientos").value;
        var pruebasMedicas = document.getElementById("pruebas_medicas").value;
        var alergias = document.getElementById("alergias").value;

        // Lógica para guardar esta información, por ejemplo, en una base de datos o local storage
        console.log(
          "Guardar EMR",
          historiaClinica,
          diagnosticos,
          tratamientos,
          pruebasMedicas,
          alergias
        );
      }
      function agregarUsuario() {
        const nombre = document.getElementById("nombre").value;
        const apellido = document.getElementById("apellido").value;
        const clave = document.getElementById("clave").value;
        const email = document.getElementById("email").value;
        const rol = document.getElementById("rol").value;
        const nuevoUsuario = new Usuario(
          controlUsuario.obtenerListaUsuarios().length,
          nombre,
          apellido,
          clave,
          email,
          rol
        );
        //agregamos
        controlUsuario.adicionar_Usuario(nuevoUsuario);
        // actualizamos
        armar_tabla_usuarios(controlUsuario.obtenerListaUsuarios());
        // Limpiamos el formulario
        document.getElementById("formulario_usuario").reset();
      }
      function editar(id) {
        const usuario = controlUsuario
          .obtenerListaUsuarios()
          .find((u) => u.id === id);
        document.getElementById("nombre").value = usuario.nombre;
        document.getElementById("apellido").value = usuario.apellido;
        document.getElementById("clave").value = usuario.clave;
        document.getElementById("email").value = usuario.email;
        document.getElementById("rol").value = usuario.rol;
        document.getElementById("formulario").innerHTML = "Editar Usuario";
        //const btn = document.querySelector("#formulario_usuario button");
        const btn = document.getElementById("boton1");
        btn.onclick = function () {
          guardarCambios(id);
        };
        btn.textContent = "Guardar Cambios";
      }
      function guardarCambios(id) {
        const usuario = controlUsuario
          .obtenerListaUsuarios()
          .find((u) => u.id === id);
        usuario.nombre = document.getElementById("nombre").value;
        usuario.apellido = document.getElementById("apellido").value;
        usuario.clave = document.getElementById("clave").value;
        usuario.email = document.getElementById("email").value;
        usuario.rol = document.getElementById("rol").value;
        armar_tabla_usuarios(controlUsuario.obtenerListaUsuarios());
        document.getElementById("formulario_usuario").reset();
        document.getElementById("formulario").innerHTML =
          "Agregar Nuevo Usuario";
        //const btn = document.querySelector("#formulario_usuario button");
        const btn = document.getElementById("boton1");
        btn.onclick = agregarUsuario;
        btn.textContent = "Agregar Usuario";
      }
      function eliminar(id) {
        const listaUsuarios = controlUsuario.obtenerListaUsuarios();
        const indiceUsuario = listaUsuarios.findIndex((u) => u.id === id);
        if (indiceUsuario !== -1) {
          listaUsuarios.splice(indiceUsuario, 1);
          armar_tabla_usuarios(listaUsuarios);
        }
      }
      function buscar(nom) {
        elemento = document.getElementById(nom).value;
        const usuariosEncontrados = controlUsuario
          .obtenerListaUsuarios(nom)
          .filter(
            (u) =>
              u.nombre.toLowerCase().includes(elemento.toLowerCase()) ||
              u.id === parseInt(elemento)
          );
        console.log(usuariosEncontrados);
        armar_tabla_usuarios(usuariosEncontrados);
      }
    </script>
  </body>
</html>
